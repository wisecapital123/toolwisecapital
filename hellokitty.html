<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OMNI-KITTY vFINAL LEGENDARY</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Nunito:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --pink: #ff69b4; --deep-pink: #c71585; --bg: #fff0f5;
            --white: #ffffff; --tai: #ff4757; --xiu: #2ed573; --gold: #ffd700;
        }
        * { box-sizing: border-box; font-family: 'Nunito', sans-serif; -webkit-tap-highlight-color: transparent; }
        body {
            background-color: var(--bg);
            background-image: radial-gradient(#ffc2d1 10%, transparent 11%), radial-gradient(#ffc2d1 10%, transparent 11%);
            background-size: 30px 30px; background-position: 0 0, 15px 15px;
            margin: 0; padding: 10px; display: flex; justify-content: center; min-height: 100vh;
        }

        .container {
            width: 100%; max-width: 550px;
            background: rgba(255,255,255,0.98);
            border: 4px solid var(--pink); border-radius: 25px;
            padding: 15px; box-shadow: 0 10px 40px rgba(255, 105, 180, 0.4);
            position: relative; overflow: hidden; display: flex; flex-direction: column;
        }

        /* HEADER */
        .header { text-align: center; margin-bottom: 10px; position: relative; z-index: 2; }
        .header h2 { margin: 0; color: var(--deep-pink); font-family: 'Fredoka', sans-serif; font-size: 22px; }
        .header span { font-size: 9px; color: #fff; background: var(--pink); padding: 3px 10px; border-radius: 12px; font-weight: bold; }
        .bow { position: absolute; top: -5px; right: 5px; font-size: 35px; transform: rotate(15deg); filter: drop-shadow(2px 2px 0 rgba(0,0,0,0.1)); }

        /* NEURAL MATRIX (Gi·ªØ nguy√™n giao di·ªán vULTRA b·∫°n th√≠ch) */
        .neural-box {
            background: #fff; border: 2px dashed var(--pink); border-radius: 15px;
            padding: 8px; margin-bottom: 10px;
        }
        .matrix-grid { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 4px; }
        .matrix-item {
            background: #fff0f6; border-radius: 8px; padding: 4px; 
            display: flex; flex-direction: column; align-items: center; text-align: center;
        }
        .m-label { font-size: 8px; color: var(--deep-pink); font-weight: bold; text-transform: uppercase; }
        .m-bar-bg { width: 100%; height: 4px; background: #ddd; border-radius: 3px; margin: 3px 0; overflow: hidden; }
        .m-bar-fill { height: 100%; background: var(--pink); width: 50%; transition: width 0.5s; }
        .m-val { font-size: 8px; font-weight: bold; }

        /* INPUTS (NGANG - KH√îNG B·ªä CHE) */
        .input-group { display: flex; gap: 8px; margin-bottom: 10px; }
        input {
            width: 100%; padding: 12px; border: 2px solid #ffc2d1; color: var(--deep-pink);
            outline: none; border-radius: 15px; text-align: center; font-weight: bold; font-size: 14px;
            background: #fff;
        }
        input:focus { border-color: var(--pink); }
        #prevScore { width: 30%; } 

        .btn-calc {
            width: 100%; background: linear-gradient(45deg, var(--pink), #ff1493);
            color: #fff; border: none; padding: 14px; font-weight: 900; cursor: pointer;
            font-family: 'Fredoka', sans-serif; font-size: 16px; margin-bottom: 10px;
            border-radius: 20px; box-shadow: 0 4px 0 #c71585; transition: 0.1s;
        }
        .btn-calc:active { transform: translateY(3px); box-shadow: none; }

        /* RESULT */
        .result-box {
            text-align: center; border: 3px solid var(--pink); padding: 10px;
            margin-bottom: 10px; background: radial-gradient(circle, #fff 0%, #ffe6f0 100%);
            border-radius: 20px; position: relative;
        }
        .res-main {
            font-family: 'Fredoka', sans-serif; font-size: 45px; font-weight: 900;
            margin: 5px 0; line-height: 1; text-shadow: 2px 2px 0 #fff;
        }
        .res-info { font-size: 9px; color: #555; background: rgba(255,255,255,0.8); padding: 5px; border-radius: 8px; margin-top: 5px; }

        /* TRAINING */
        .train-ui { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; display: none; }
        .btn-train { padding: 12px; border: none; color: #fff; font-weight: bold; cursor: pointer; border-radius: 15px; font-size: 12px; }

        /* HISTORY */
        .h-list {
            display: flex; gap: 4px; margin-top: 10px; overflow-x: auto;
            border-top: 2px dashed #eee; padding-top: 8px;
        }
        .h-dot {
            width: 18px; height: 18px; border-radius: 50%; font-size: 9px; flex-shrink: 0;
            display: flex; align-items: center; justify-content: center;
            background: #f0f0f0; border: 1px solid #ddd; color: #fff;
        }
        
        .toast {
            position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8); color: #fff; padding: 10px 20px; border-radius: 20px;
            font-size: 12px; display: none; z-index: 100;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="bow">üéÄ</div>
    <div id="toastMsg" class="toast">Th√¥ng b√°o</div>
    
    <div class="header">
        <h2>OMNI-KITTY vFINAL</h2>
        <span>Restored Core v18.0 + Compact UI</span>
    </div>

    <div class="neural-box">
        <div class="matrix-grid">
            <div class="matrix-item">
                <span class="m-label">M·∫≠t ƒë·ªô Bit</span>
                <div class="m-bar-bg"><div id="bar1" class="m-bar-fill"></div></div>
                <span id="val1" class="m-val">100%</span>
            </div>
            <div class="matrix-item">
                <span class="m-label">ƒê·ªô L·ªách</span>
                <div class="m-bar-bg"><div id="bar2" class="m-bar-fill"></div></div>
                <span id="val2" class="m-val">100%</span>
            </div>
            <div class="matrix-item">
                <span class="m-label">Kh·ªõp M·∫´u</span>
                <div class="m-bar-bg"><div id="bar3" class="m-bar-fill"></div></div>
                <span id="val3" class="m-val">100%</span>
            </div>
            <div class="matrix-item">
                <span class="m-label">Vector</span>
                <div class="m-bar-bg"><div id="bar4" class="m-bar-fill"></div></div>
                <span id="val4" class="m-val">Thu·∫≠n</span>
            </div>
        </div>
    </div>

    <div class="input-group">
        <input type="text" id="hashIn" placeholder="D√°n m√£ MD5 (32 k√Ω t·ª±)" maxlength="32">
        <input type="tel" id="prevScore" placeholder="ƒêi·ªÉm" maxlength="2">
    </div>

    <button class="btn-calc" onclick="runAnalysis()">‚ú® PH√ÇN T√çCH ‚ú®</button>

    <div class="result-box">
        <div style="font-size: 9px; color: #aaa; font-weight: bold;">K·∫æT QU·∫¢ D·ª∞ ƒêO√ÅN</div>
        <div id="resFinal" class="res-main" style="color:#ddd">WAIT</div>
        <div id="resInfo" class="res-info">H·ªá th·ªëng ƒëang ch·ªù d·ªØ li·ªáu...</div>
    </div>

    <div class="train-ui" id="trainUI">
        <button class="btn-train" style="background:var(--tai);" onclick="train('T√ÄI')">TH·ª∞C T·∫æ: T√ÄI üçì</button>
        <button class="btn-train" style="background:var(--xiu);" onclick="train('X·ªàU')">TH·ª∞C T·∫æ: X·ªàU üçè</button>
    </div>

    <div class="h-list" id="hList"></div>
    <div style="text-align:center; font-size:9px; color:#ccc; margin-top:5px;" onclick="reset()">[ RESET B·ªò NH·ªö ]</div>
</div>

<script>
    // Database v18 Restore
    let db = JSON.parse(localStorage.getItem('omni_final_v1')) || { 
        history: [], vector: 1, patterns: [],
        weights: { bit: 20, sd: 20, pattern: 20 } // Tr·ªçng s·ªë uy t√≠n
    };
    
    let currentPrediction = "";

    function msg(text) {
        const t = document.getElementById('toastMsg');
        t.innerText = text;
        t.style.display = 'block';
        setTimeout(() => t.style.display = 'none', 2000);
    }

    function updateWeightsUI() {
        let maxW = Math.max(db.weights.bit, db.weights.sd, db.weights.pattern, 1);
        
        const setBar = (idBar, idVal, val) => {
            let pct = (val / maxW * 100).toFixed(0);
            document.getElementById(idBar).style.width = pct + "%";
            document.getElementById(idVal).innerText = `${pct}%`;
            document.getElementById(idBar).style.background = pct < 40 ? "#ccc" : "var(--pink)";
        };

        setBar('bar1', 'val1', db.weights.bit);
        setBar('bar2', 'val2', db.weights.sd);
        setBar('bar3', 'val3', db.weights.pattern);

        document.getElementById('bar4').style.width = "100%";
        document.getElementById('bar4').style.background = db.vector === 1 ? "var(--xiu)" : "var(--tai)";
        document.getElementById('val4').innerText = db.vector === 1 ? "Thu·∫≠n" : "ƒê·∫¢O";
        document.getElementById('val4').style.color = db.vector === 1 ? "var(--xiu)" : "var(--tai)";
    }

    function runAnalysis() {
        const hash = document.getElementById('hashIn').value.trim().toLowerCase();
        const score = parseInt(document.getElementById('prevScore').value);

        if (!/^[a-f0-9]{32}$/.test(hash)) return msg("üö´ M√£ Hash sai r·ªìi!");

        // --- KH√îI PH·ª§C THU·∫¨T TO√ÅN v18 (M·∫†NH NH·∫§T) ---
        
        // 1. Bit Density
        let bits = "";
        let hexVals = [];
        for(let c of hash) {
            bits += parseInt(c, 16).toString(2).padStart(4, '0');
            hexVals.push(parseInt(c, 16));
        }
        let ones = (bits.match(/1/g) || []).length;
        let density = ((ones / 128) * 100);
        let pBit = density > 50 ? "T√ÄI" : "X·ªàU";

        // 2. SD (Standard Deviation)
        let mean = hexVals.reduce((a,b)=>a+b)/32;
        let variance = hexVals.reduce((a,b)=>a+Math.pow(b-mean,2),0)/32;
        let sd = Math.sqrt(variance);
        let pSD = sd > 4.1 ? "T√ÄI" : "X·ªàU";

        // 3. Pattern Matching (So kh·ªõp m·∫´u - C·ª±c quan tr·ªçng)
        let matchScore = 0;
        let matchCount = 0;
        db.patterns.forEach(p => {
            // N·∫øu m·∫´u c≈© c√≥ m·∫≠t ƒë·ªô bit +- 2% so v·ªõi hi·ªán t·∫°i -> C√≥ li√™n quan
            if (Math.abs(p.d - density) < 2) {
                matchScore += (p.res === "T√ÄI" ? 1 : -1);
                matchCount++;
            }
        });
        let pPattern = "---";
        if(matchCount > 0) pPattern = matchScore >= 0 ? "T√ÄI" : "X·ªàU";

        // 4. Extreme Reversion Bias (Th√™m v√†o t·ª´ vUltra)
        let biasScore = 0;
        if(!isNaN(score)) {
            if(score <= 4) biasScore = 15; // B·∫Øt ƒë√°y c·ª±c m·∫°nh (T√†i)
            else if(score >= 17) biasScore = -15; // B·∫Øt ƒë·ªânh c·ª±c m·∫°nh (X·ªâu)
            else if(score <= 8) biasScore = 5;
            else if(score >= 13) biasScore = -5;
        }

        // --- T√çNH T·ªîNG ƒêI·ªÇM ---
        let sTai = 0, sXiu = 0;
        
        if(pBit === "T√ÄI") sTai += db.weights.bit; else sXiu += db.weights.bit;
        if(pSD === "T√ÄI") sTai += db.weights.sd; else sXiu += db.weights.sd;
        if(pPattern === "T√ÄI") sTai += db.weights.pattern; else if(pPattern === "X·ªàU") sXiu += db.weights.pattern;

        // C·ªông ƒëi·ªÉm Bias (H·ªìi quy)
        if(biasScore > 0) sTai += Math.abs(biasScore);
        else sXiu += Math.abs(biasScore);

        let finalScore = sTai - sXiu;
        finalScore *= db.vector; // ƒê·∫£o chi·ªÅu n·∫øu AI ƒëang "D·ªói"

        let finalRes = finalScore > 0 ? "T√ÄI" : "X·ªàU";
        currentPrediction = finalRes;

        // T√≠nh ƒë·ªô tin c·∫≠y
        let totalW = db.weights.bit + db.weights.sd + db.weights.pattern + Math.abs(biasScore);
        let conf = (Math.abs(finalScore) / totalW * 100);
        conf = Math.min(99, conf + 45).toFixed(0);

        // HI·ªÇN TH·ªä
        const resEl = document.getElementById('resFinal');
        resEl.innerText = finalRes;
        resEl.style.color = finalRes === "T√ÄI" ? "var(--tai)" : "var(--xiu)";

        let info = `M·∫≠t ƒë·ªô: ${density.toFixed(1)}% | Kh·ªõp m·∫´u: ${matchCount} | H·ªìi quy: ${biasScore !== 0 ? 'K√çCH HO·∫†T' : 'T·∫Øt'}`;
        document.getElementById('resInfo').innerHTML = `${info}<br><b>ƒê·ªô tin c·∫≠y: ${conf}%</b>`;

        document.getElementById('trainUI').style.display = "grid";
        updateWeightsUI();
    }

    function train(actual) {
        let isCorrect = (currentPrediction === actual);
        
        // 1. H·ªçc tr·ªçng s·ªë (N·∫øu ƒë√∫ng -> tƒÉng uy t√≠n)
        // L∆∞u √Ω: Logic Pattern Matching c·∫ßn ph·∫£i ƒë∆∞·ª£c c·∫≠p nh·∫≠t ·ªü ƒë√¢y
        let density = parseFloat(document.getElementById('resInfo').innerText.split('%')[0].split(':')[1]);
        
        if(isCorrect) {
            // L∆∞u m·∫´u th·∫Øng v√†o b·ªô nh·ªõ
            db.patterns.push({ d: density, res: actual });
            if(db.patterns.length > 50) db.patterns.shift();
        }

        // 2. Auto-Vector (T·ª± ƒë·∫£o chi·ªÅu)
        db.history.unshift(isCorrect);
        let last2 = db.history.slice(0, 2);
        if(last2.length === 2 && last2.every(x => !x)) {
            db.vector *= -1;
            msg("‚ö†Ô∏è ƒê·∫£o chi·ªÅu AI!");
        }

        if(db.history.length > 20) db.history.pop();
        localStorage.setItem('omni_final_v1', JSON.stringify(db));
        
        renderHist();
        updateWeightsUI();
        document.getElementById('trainUI').style.display = "none";
        document.getElementById('hashIn').value = "";
    }

    function renderHist() {
        const list = document.getElementById('hList');
        list.innerHTML = db.history.map(x => 
            `<div class="h-dot" style="background:${x ? 'var(--xiu)' : 'var(--tai)'}">${x ? '‚úî' : '‚úò'}</div>`
        ).join('');
    }

    function reset() {
        if(confirm("Reset AI?")) {
            localStorage.removeItem('omni_final_v1');
            location.reload();
        }
    }

    updateWeightsUI();
    renderHist();
</script>
</body>
</html>
