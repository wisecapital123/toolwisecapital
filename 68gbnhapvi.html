<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MD5 MATRIX v3000</title>
    <style>
        :root { --neon: #00ff00; --bg: rgba(0, 0, 0, 0.95); }
        body { background: #000; margin: 0; font-family: -apple-system, sans-serif; overflow: hidden; color: #fff; }
        #game-view { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; z-index: 1; }
        
        #toggle-tool {
            position: absolute; top: 10px; right: 10px; width: 38px; height: 38px;
            background: var(--neon); color: #000; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 18px; z-index: 1001; cursor: pointer; box-shadow: 0 0 10px var(--neon);
        }

        .tool-panel { 
            position: absolute; bottom: 5px; left: 50%; transform: translateX(-50%);
            width: 98%; background: var(--bg); border: 1.5px solid var(--neon);
            border-radius: 12px; padding: 8px; box-sizing: border-box; z-index: 1000;
        }
        .hidden { display: none; }

        /* Hàng nhập liệu Matrix: Đảm bảo không bao giờ tràn */
        .matrix-row { display: flex; align-items: center; gap: 4px; width: 100%; }
        
        #sid { 
            flex: 1; min-width: 60px; background: #111; border: 1px solid #444; 
            color: var(--neon); height: 32px; border-radius: 4px; padding: 0 4px; 
            font-size: 12px; font-weight: bold; outline: none;
        }

        .v-sq { 
            width: 32px !important; height: 32px !important; 
            background: #222; border: 1px solid #555; color: #fff;
            border-radius: 4px; text-align: center; font-weight: bold; font-size: 14px;
            outline: none; flex-shrink: 0;
        }
        .v-sq:focus { border-color: var(--neon); background: #000; }

        .btn-calc { 
            background: var(--neon); color: #000; border: none; 
            height: 32px; padding: 0 10px; border-radius: 4px; 
            font-weight: 900; font-size: 11px; cursor: pointer; flex-shrink: 0;
        }

        .display-area { text-align: center; margin-top: 6px; border-top: 1px solid #222; padding-top: 6px; }
        #result { font-size: 20px; font-weight: 900; line-height: 1.2; }
        
        .dice-prev { display: flex; justify-content: center; gap: 5px; margin-top: 4px; }
        .dot-val { width: 22px; height: 22px; background: #fff; color: #000; border-radius: 3px; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 13px; }
        
        .sys-log { display: flex; justify-content: space-between; font-size: 8px; color: #555; margin-top: 4px; text-transform: uppercase; }
        b { color: var(--neon); }
    </style>
</head>
<body>

    <div id="toggle-tool" onclick="toggle()">⚡</div>
    <iframe id="game-view" src="https://68gbvn88.bar/?code=10439446"></iframe>

    <div class="tool-panel" id="panel">
        <div class="matrix-row">
            <input type="number" id="sid" placeholder="Phiên #">
            <input type="number" id="v1" class="v-sq" placeholder="V1" oninput="limit(this)">
            <input type="number" id="v2" class="v-sq" placeholder="V2" oninput="limit(this)">
            <input type="number" id="v3" class="v-sq" placeholder="V3" oninput="limit(this)">
            <button class="btn-calc" onclick="runMatrix()">PHÂN TÍCH</button>
        </div>
        
        <div class="display-area">
            <div id="result" style="color: #444;">DỮ LIỆU TRỐNG</div>
            
            <div class="dice-prev" id="dice-ui" style="display: none;">
                <div class="dot-val" id="r1"></div>
                <div class="dot-val" id="r2"></div>
                <div class="dot-val" id="r3"></div>
            </div>

            <div class="sys-log">
                <span>VER: <b>3.0 MATRIX</b></span>
                <span>SIGNAL: <b id="signal">STABLE</b></span>
            </div>
        </div>
    </div>

<script>
    function toggle() { document.getElementById('panel').classList.toggle('hidden'); }
    function limit(element) { if(element.value.length > 1) element.value = element.value.slice(0,1); }

    function runMatrix() {
        const sid = document.getElementById('sid').value;
        const v1 = parseInt(document.getElementById('v1').value);
        const v2 = parseInt(document.getElementById('v2').value);
        const v3 = parseInt(document.getElementById('v3').value);

        if(!sid || isNaN(v1) || isNaN(v2) || isNaN(v3)) return;

        const res = document.getElementById('result');
        const ui = document.getElementById('dice-ui');
        res.innerText = "MATRIX SCANNING...";
        res.style.color = "#00ff00";

        setTimeout(() => {
            const sum = v1 + v2 + v3;
            const last3 = parseInt(sid.slice(-3));
            
            // Thuật toán Matrix v3.0: 
            // Sử dụng logic bù trừ: (Phiên + Tổng điểm) * (Điểm viên 1)
            const formula = ((last3 + sum) * v1) % 100;
            
            let side = formula > 45 ? "VÀO: TÀI" : "VÀO: XỈU";
            let color = formula > 45 ? "#ff3b30" : "#ffffff";
            let d = formula > 45 ? [6, 4, 2] : [1, 3, 2];

            res.innerText = side;
            res.style.color = color;
            res.style.textShadow = `0 0 10px ${color}`;
            
            document.getElementById('r1').innerText = d[0];
            document.getElementById('r2').innerText = d[1];
            document.getElementById('r3').innerText = d[2];
            document.getElementById('signal').innerText = "LOCKED";
            ui.style.display = "flex";
        }, 800);
    }
</script>

</body>
</html>
